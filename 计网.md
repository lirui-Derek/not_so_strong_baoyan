## 1、计算机网络七层协议

```
应用层：应用层的任务是通过应用程序之间的交互来完成特定网络作用。Http协议，域名系统DNS

表示层：数据的表示，安全和压缩。确保系统应用层间的交互。

会话层：建立、管理、终止会话,对应主机进程，指本地主机与远程主机正在进行的会话。

传输层：两台主机进程之间的通信提供数据传输服务。TCP和UDP。

网络层：选择合适的网间路由和交换节点，确保数据及时送达。源/目的主机间的报文分组传输服务。IP协议。

数据链路层：为网络层提供无差错的数据帧传输。

物理层：实现相邻计算机节点之间比特流的透明传输。
```

## 2、TCP和UDP

```
TCP是面向连接的、可靠的，以字节流大形式传输。

​		TCP协议如何保证可靠传输：

​		校验和：

​		序列号：

​		超时重传：

​		流量控制：TCP 提供的可以让「发送方」根据「接收方」的实际接收能力控制发送数据量的⼀种机制。**滑动窗口机制**

​		拥塞控制：拥塞控制是一个全局性的过程，而流量控制指点对点通信量的控制。在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种情况就叫拥塞。而拥塞控制就是为了防止过多的数据注入到网络中，这样就可以使网络中的路由器或链路不致于过载。慢开始 、 拥塞避免 、快重传、快恢复：

UDP是无连接的，不安全的传输，面向报文，但快速有效，一般用于即时通信。
```

![0](C:\Users\lirui\AppData\Roaming\Typora\typora-user-images\image-20220709090320900.png)



## 3、GET与POST的区别？

1、安全性

2、作用

3、长度

4、**POST** 方法会产生两个 **TCP** 数据包，浏览器会先将请求头发送给服务器，待服务器响应100 continue，浏览器再发送请求数据，服务器响应200 ok(返回数据)。这么看起来 **GET** 请求的传输会比 **POST** 快上一些（因为**GET** 方法只发送一个 **TCP** 数据包），但是实际上在网络良好的情况下它们的传输速度基本相同。

5、**参数位置**：`GET`的参数**放在URL中**，`POST`的参数**存储在实体主体中**，并且`GET`方法提交的请求的URL中的数据最多是2048字节，POST请求没有大小限制



## 4、浏览器中输入URL到显示的过程

```
1、DNS解析：浏览器查询DNS，获得域名对应IP地址。
2、TCP连接：三次连接
3、发送HTTP请求：
4、服务器处理并返回HTTP报文：
5、浏览器解析渲染页面
6、连接结束
```

## 5、URI和URL区别

```
URI 统一资源标识符，可以唯一标识一个资源
URL 统一资源定位符，可以提供该资源的路径，是一种具体的URI，可以用来标识一个资源，而且还指明了如何定位到这个资源。
```

## 6、三次握手与四次挥手

```
如果是三次握手，不会出现双方连接还未完全建立成功就开始发送数据的情况。


```

## 面试官问：为什么TCP连接的时候是3次，关闭的时候却是4次?

```
关闭连接时，客户端向服务端发送FIN 时，仅仅表示客户端不再发送数据了但是还能接收数据。
服务器收到客户端的FIN 报文时，先回一个ACK应答报文，而服务端可能还有数据需要处理和发送，等服务端不再发送数据时，才发送FIN 报文给客户端来表示同意现在关闭连接。
从上面过程可知，服务端通常需要等待完成数据的发送和处理，所以服务端的ACK 和FIN一般都会分开发送，从而比三次握手导致多了一次。
```



## 为什么客户端发出第四次挥手的确认报文后要等2MSL的时间才能释放TCP连接?

```
MSL的意思是报文的最长寿命。要确保服务器是否已经收到了我们的ACK报文，过了一个MSL后如果没有收到的话，服务器会重新发FIN报文给客端，此时又花了一个MSL，客户端再次收到FIN报文之后，就知道之前的ACK报文丢失了，然后再次发送ACK报文，一来一去正好2个MSL。
```

## 7、ARP协议——IP地址转MAC地址

## 8、主机通信的完整过程

![image-20220719103035065](C:\Users\lirui\AppData\Roaming\Typora\typora-user-images\image-20220719103035065.png)

## 9、面试题目：数据放在服务端和客户端的利与弊？

答：服务端统一处理有更好的安全性和稳定性而且升级比较容易，不过服务器负担就增加了。

客户端将负担分配到每个用户，从而可以节约服务器资源，安全性和稳定性可能会有一定的问题，升级也比较麻烦，每个安装的客户端程序都需要升级，另外为了节省网络资源，通过网络传输的数据应该尽量减少！


## 逐层复习

### 1、物理层

​		该层利用传输介质为通信的两端建立、管理和释放物理连接，实现**比特流**的透明传输。

​		物理层考虑的是怎样在连接各种计算机的传输媒体上传输数据比特流，尽可能屏蔽不同种类的传输媒体和通信手段差异，使物理层上面的数据链路层感觉不到这些差异，这样就可以使数据链路层只考虑完成本层的协议和服务，而不必考虑网络的具体传输媒体和通信手段是什么。

#### 1、主机之间的通信方式

- 单工通信：也叫单向通信，发送方和接收方是固定的，消息只能单向传输。例如采集气象数据、家庭电费，网费等数据收集系统，或者打印机等应用主要采用单工通信。
- 半双工通信：通信双方都可以发送消息，但同一时刻同一信道只允许单方向发送数据。例如传统的对讲机使用的就是半双工通信。
- 全双工通信：允许通信双方同时在两个方向上传输，其要求通信双方都具有独立的发送和接收数据的能力

#### 2、通道复用技术

- 频分复用
- 时分复用
- 波分复用
- 码分复用

#### 3、集线器（Hub）

​		物理层设备，主要用于星形拓扑网络，集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。





### 2、数据链路层

#### 1、MAC地址与IP地址

MAC地址：48位，物理层和数据链路层使用的地址，是写在网卡上的物理地址。MAC地址用来定义网络设备的位置。

IP地址：32位，网络层和以上各层使用的地址，逻辑地址。IP地址用来区别网络上的计算机。基于网络拓扑分配。

**1、为什么有了MAC地址还需要IP地址？**

​		如果我们只使用 MAC 地址进行寻址的话，我们需要路由器记住每个 MAC 地址属于哪一个子网，不然每一次路由器收到数据包时都要满世界寻找目的 MAC 地址。而我们知道 MAC 地址的长度为 48 位，也就是说最多总共有 2 的 48 次方个 MAC 地址，这就意味着每个路由器需要 256 T 的内存，这显然是不现实的。

​		和 MAC 地址不同，IP 地址是和地域相关的，在一个子网中的设备，我们给其分配的 IP 地址前缀都是一样的，这样路由器就能根据 IP 地址的前缀知道这个设备属于哪个子网，剩下的寻址就交给子网内部实现，从而大大减少了路由器所需要的内存。

**2、为什么有了 IP 地址还需要 MAC 地址？**

​		只有当设备连入网络时，才能根据他进入了哪个子网来为其分配 IP 地址，在设备还没有 IP 地址的时候或者在分配 IP 地址的过程中，我们需要 MAC 地址来区分不同的设备。

#### 2、数据链路层三个基本问题

1、封装成帧：将从网络层传下来的数据报文添加首部和尾部后封装成帧。首部和尾部的一个重要作用是帧定界，也携带了一些必要的控制信息，对于每种数据链路层协议都规定了帧的数据部分的最大长度。

2、透明传输：*透明传输*是指不管所传数据是什么样的比特组合，都应当能够在链路上传送，而不与控制信息混淆。

​			  方法：字节填充法（转义字符）；比特填充法（连续1加0）。

3、差错控制：循环冗余检验（CRC）来检查数据传输过程中是否产生比特差错。



#### 3、网桥和交换机

​		网桥工作在数据链路层，根据MAC帧的目的地址对收到的帧进行转发。分离了广播域和碰撞域。

​		转发表，基于自学习算法的帧转发。

​		网桥（Bridge）是早期的两端口二层网络设备。网桥的两个端口分别有一条独立的交换信道，不是共享一条背板总线，可隔离冲突域。网桥比集线器（Hub）性能更好，集线器上各端口都是共享同一条背板总线的。后来，网桥被具有更多端口、同时也可隔离冲突域的交换机（Switch）所取代。

​		网桥将两个相似的[网络](https://baike.baidu.com/item/网络/143243)连接起来，并对[网络数据](https://baike.baidu.com/item/网络数据/509706)的流通进行管理。它工作于[数据链路层](https://baike.baidu.com/item/数据链路层)，不但能扩展网络的距离或范围，而且可提高网络的性能、可靠性和安全性。可利用网桥隔离信息，将同一个网络号划分成多个网段（属于同一个网络号），隔离出安全网段，防止其他网段内的用户非法访问。由于网络的分段，各网段相对独立（属于同一个网络号），一个网段的故障不会影响到另一个网段的运行。



​		交换机相当于一个多端口的网桥。



#### 4、HDLC协议（High-level Data Link Control）

​		高级数据链路控制（HDLC，High-level Data Link Control）是一组用于在网络结点间传送数据的协议，是由[国际标准化组织](https://baike.baidu.com/item/国际标准化组织/779832)（ISO）颁布的一种高可靠性、高效率的数据链路控制规程，其特点是各项数据和控制信息都以**比特**为单位，采用“帧”的格式传输。

​		**主要应用在通信领域，主要使用在传统的电信网络设备上。如思科的路由器等。**

​		多点寻址。

​		有编号和确认机制。

​		差错检测。

​		透明传输。

#### 5、PPP协议（Point to Point Protocol）

​		PPP协议借用了HDLC的格式。

​		点对点协议为点对点连接上传输多协议数据包提供了一个标准方法。该协议设计的目的主要是用来通过拨号或专线方式建立点对点连接发送数据，使其成为各种主机、网桥和路由器之间简单连接的一种解决方案。

​		面向字节。

PPP 协议具有以下特点：

​		PPP 协议具有动态分配 IP 地址的能力，其允许在连接时刻协商 IP 地址。
​		PPP 支持多种网络协议，例如 TCP/IP、NETBEUI 等。
​		PPP 具有差错检测能力，但不具备纠错能力，所以 PPP 是不可靠传输协议。
​		无重传的机制，网络开销小，速度快。
​		PPP 具有身份验证的功能。

**为什么 PPP 协议不使用序号和确认机制？**

​		IETF 在设计因特网体系结构时把其中最复杂的部分放在 TCP 协议中，而网际协议 IP 则相对比较简单，它提供的是不可靠的数据包服务，在这种情况下，数据链路层没有必要提供比 IP 协议更多的功能。若使用能够实现可靠传输的数据链路层协议，则开销就要增大，这在数据链路层出现差错概率不大时是得不偿失的。



LCP子层：主要负责数据链路的建立、配置和测试。

三种帧：链路配置报文，链路维护报文，链路终止报文。

LCP 两端通过发送请求和应答帧的方式进行交互协商各种配置选项。

NCP子层：介于网络层和数据链路层之间起作用。

根据网络层的不同协议互相交换特定的 控制报文 、配置不同上层协议。



PPP协议认证

1、口令认证协议（PAP）

​		由链路的一端向另一端发送用户名和密码，另一端以收到的用户名和密码判断是否建立连接。

2、挑战握手认证协议（CHAP）

​		是PPP协议中安全性较高的认证协议。由认证端小被认证端发出挑战“challenge”信息，通常是要求用户名和密码，被认证端将挑战应答的hash函数值发送给认证端。认证端根据收到的响应决定是否建立连接。



#### 6、媒介访问控制技术（MAC技术）

​		MAC技术用于解决公共信道使用产生竞争时，如何分配信道使用权的问题。

![image-20220720115302029](C:\Users\lirui\AppData\Roaming\Typora\typora-user-images\image-20220720115302029.png)

CSMA/CD	先听后说，边听边说，发生碰撞，随机避退。

CSMA/CA	载波监听多路访问/冲突避免机制，一般工作在无线网。

无线网与有线网有很大区别，如：

- 发生碰撞的信号能量通常较小，很难被检测出来；
- 隐蔽结点问题：发送结点无法检测到隐蔽结点，从而存在冲突的可能性。

![image-20220720134946709](C:\Users\lirui\AppData\Roaming\Typora\typora-user-images\image-20220720134946709.png)

- 暴露结点问题：发送结点检测到有冲突的结点其实并不影响其发送数据。

![image-20220720134929927](C:\Users\lirui\AppData\Roaming\Typora\typora-user-images\image-20220720134929927.png)

#### 7、虚拟局域网（VLAN）

​		是由局域网中不同网段上的结点所构成的逻辑网段，这些结点与其真实的物理位置和真实网段无关。

​		每个VLAN的帧中都会插入一个明确的标识符（tag），指明发送这个帧的结点所属VLAN。

​		VLAN只是一种服务，而不是一种新型局域网。

​		VLAN能隔离广播风暴和冲突。







### 3、网络层——主机间的逻辑通信

​		在数据链路层的支持下，为传输层提供源/目的主机间的报文分组传输服务。

#### 1、NAT（Network Address Translator）

是用于在本地网络中使用私有地址，在连接互联网时转而使用全局 IP 地址的技术。NAT实际上是为解决[IPv4地址短缺](https://bk.tw.lvfukeji.com/baike-IPv4位址枯竭)而开发的技术。

如下图所示，以 10.0.0.10 的主机与 163.221.120.9 的主机进行通信为例讲解 NAT 的工作机制。利用 NAT，途中的 NAT 路由器将发送源地址从 10.0.0.10 转换为全局的 IP 地址（202.244.174.37）再发送数据。反之，当响应数据从 163.221.120.9 发送过来时，目标地址（202.244.174.37）先被转换成私有 IP 地址 10.0.0.10 以后再被转发。

![NAT工作机制](https://img-blog.csdnimg.cn/20201228085833626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpbmdzaHVhbmdsdTI1NjQ=,size_16,color_FFFFFF,t_70)

在整个流程当中，最关键的有以下几点：

​		网络被分为私网和公网两个部分，NAT网关设置在私网到公网的路由出口位置，双向流量必须都要经过NAT网关。

​		网络访问只能先由私网侧发起，公网无法主动访问私网主机。

​		NAT 路由器在两个访问方向上完成两次地址的转换或翻译，出方向做源信息替换，入方向做目的信息替换；

​		NAT 路由器的存在对通信双方是保持透明的；

​		NAT 路由器为了实现双向翻译的功能，需要维护一张关联表，把会话的信息保存下来。

**NAT 有 3 中类型：静态NAT，动态NAT，端口复用NAPT**

NAT（网络地址转换）有三种方法：静态转换、动态转换、端口复用。
静态转换：私网地址转换为固定公网地址，当公网地址被占用，则相应设备无法联网。
动态转换：私网地址转换为不固定的公网地址，避免了公网地址被占用的问题。
端口复用：私网地址通过同一个公网地址的不同端口传输。这样隐藏了内部网络中的主机，避免了根据地址的攻击。同时节约了ip地址资源。



#### 2、路由

##### 1、路由选择算法

​		根据某种策略，选择一条最佳的路径到达目的主机，对路由器而言，路由选择实质上是选择最佳输出端口。

- 静态策略
  - 扩散法（洪泛法）————扩散过程产生大量重复分组，导致网络无法运行。
  - 固定式路由表
  - 最佳路由选择算法——》最短路算法——》dijkstra算法

- 动态策略

  动态策略根据当前拓扑结构和流量的变化来动态改变路由，又称为自适应路由。

  - 孤立路由算法——热土豆算法

  - 集中路由选择——链路状态路由选择（L-S算法）

    每个结点定期广播路由信息，并根据最新路由信息刷新路由表。

  - 分布路由选择——距离向量路由选择（D-V算法）

    每个结点都保存一张路由表，路由表包括三个主要字段，即目的地址，最短距离、最佳输出链路。与固定路由选择不同的是：相邻结点之间定期交换路由信息（如每隔十秒），并根据最新路由信息，刷新路由表。

    

##### 2、路由协议

- OSPF（采用L-S算法，目前Internet的主要内部网关协议。）
- BGP（采用改进型的D-V算法，作为Internet外部网关协议。）



#### 3、IP协议

​		IP提供无连接的数据报服务，每个IP分组长度≤64K字节，不能保证分组可靠的、按序到达，这些留给高层协议解决。

**寻址和路由**：在IP 数据包中会携带源 IP 地址和目的 IP 地址来标识该数据包的源主机和目的主机。IP 数据报在传输过程中，每个中间节点（IP 网关、路由器）只根据网络地址进行转发，如果中间节点是路由器，则路由器会根据路由表选择合适的路径。IP 协议根据路由选择协议提供的路由信息对 IP 数据报进行转发，直至抵达目的主机。
**分段与重组**：IP 数据包在传输过程中可能会经过不同的网络，在不同的网络中数据包的最大长度限制是不同的，IP 协议通过给每个 IP 数据包分配一个标识符以及分段与组装的相关信息，使得数据包在不同的网络中能够传输，被分段后的 IP 数据报可以独立地在网络中进行转发，在到达目的主机后由目的主机完成重组工作，恢复出原来的 IP 数据包。



IP地址=<网络号+子网号+主机号>

子网掩码：网络号和子网号全为1，主机号全为0

IPv4地址不够怎么解决：

1. DHCP：动态主机配置协议。
2. CIDR：超网IP，无类别域间路由。
3. NAT：网络地址转换协议。
4. IPv6

#### 4、ARP协议和RARP协议

ARP协议：通过IP地址找到MAC地址

① 首先，每个主机都会在自己的 ARP 缓冲区中建立一个 ARP 列表，以表示 IP 地址和 MAC 地址之间的对应关系；

② 当源主机要发送数据时，首先检查 ARP 列表中是否有 IP 地址对应的目的主机 MAC 地址，如果存在，则可以直接发送数据，否则就向同一子网的所有主机发送 ARP 数据包。该数据包包括的内容有源主机的 IP 地址和 MAC 地址，以及目的主机的 IP 地址。

③ 当本网络中的所有主机收到该 ARP 数据包时，首先检查数据包中的 目的 主机IP 地址是否是自己的 IP 地址，如果不是，则忽略该数据包，如果是，则首先从数据包中取出源主机的 IP 和 MAC 地址写入到 ARP 列表中，如果已经存在，则覆盖，然后将自己的 MAC 地址写入 ARP 响应包中，告诉源主机自己是它想要找的 MAC 地址。

④ 源主机收到 ARP 响应包后。将目的主机的 IP 和 MAC 地址写入 ARP 列表，并利用此信息发送数据。如果源主机一直没有收到 ARP 响应数据包，表示 ARP 查询失败。



#### 5、ICMP协议

​		ICMP（Internet Control Message Protocol）是因特网控制报文协议，主要是实现 IP 协议中未实现的部分功能，是一种网络层协议。该协议并不传输数据，只传输控制信息来辅助网络层通信。其主要的功能是验证网络是否畅通（确认接收方是否成功接收到 IP 数据包）以及辅助 IP 协议实现可靠传输（若发生 IP 丢包，ICMP 会通知发送方 IP 数据包被丢弃的原因，之后发送方会进行相应的处理）。

- ​		Ping
- ​        TraceToute

#### 6、路由器

​		路由表的主要项目有两个：网络号、下一跳地址（最佳输出链路）

​		路由器分组转发流程

1. 从IP数据报中 提取出目的主机的IP地址，找到其所在的网络。
2.  判断目的 IP 地址所在的网络是否与本路由器直接相连，如果是，则不需要经过其它路由器直接交付，否则执行3
3. 检查路由表，使用每一行的子网掩码与目的IP匹配（最长前缀匹配）。若找到匹配路由，则按照路由表转发到下一跳路由器中，否则执行步骤4。
4. 无法找到合适路由，向源主机报错。



### 4、传输层——进程间的逻辑通信

​		传输层地址 = 主机IP地址 + 端口号

​		套接字socket={ 协议， 本地地址，本地端口 }

​		套接字上联应用程序，下联网络协议栈，是应用程序通过网络协议栈进行通信的接口，是应用程序与网络协议栈进行交互的接口。

![image-20220721232308909](C:\Users\lirui\AppData\Roaming\Typora\typora-user-images\image-20220721232308909.png)

TCP/IP协议簇

TCP协议

![image.png](https://pic.leetcode-cn.com/1614160878-FiFlkq-image.png)



![四次挥手.png](https://pic.leetcode-cn.com/1612459478-ajInIu-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png)

#### 1、为什么要三次握手，四次挥手？

​		三次握手的主要目的是确认自己和对方的发送和接收都是正常的，从而保证了双方能够进行可靠通信。若采用两次握手，当第二次握手后就建立连接的话，此时客户端知道服务器能够正常接收到自己发送的数据，而服务器并不知道客户端是否能够收到自己发送的数据。

​		

​		释放 TCP 连接时之所以需要四次挥手，是因为 FIN 释放连接报文和 ACK 确认接收报文是分别在两次握手中传输的。 当主动方在数据传送结束后发出连接释放的通知，由于被动方可能还有必要的数据要处理，所以会先返回 ACK 确认收到报文。当被动方也没有数据再发送的时候，则发出连接释放通知，对方确认后才完全关闭TCP连接。



#### 2、TIME-WAIT的作用？

​		如果没有这个状态：

​		1、此时服务端相应的端口并没有关闭，若客户端在相同的端口立即建立连接，会接收到上一次连接中残留的数据包，导致异常。

​		2、假设客户端最后一次ACK包在传输过程中丢失，由于TCP协议的超时重传机制，服务端将重发FIN报文，若客户端并没有维持 TIME-WAIT 状态而直接关闭的话，当收到服务端重新发送的 FIN 包时，客户端就会用 RST 包来响应服务端，这将会使得对方认为是有错误发生，然而其实只是正常的关闭连接过程，并没有出现异常情况。



​		时长是2MSL，MSL（Maximum Segment Lifetime），指一段 TCP 报文在传输过程中的最大生命周期。2 MSL 即是服务器端发出 FIN 报文和客户端发出的 ACK 确认报文所能保持有效的最大时长。



# DNS工作原理

一、主机向本地域名服务器的查询一般是采用递归查询。

**递归查询**：如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，本地域名服务器就以DNS客户的身份，向其他根域名服务器继续发出查询请求报文，而不是让主机自己进行下一步查询。

二、本地域名服务器向根域名服务器的查询的迭代查询。

**迭代查询**：迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。

# TCP/UDP的区别

![image-20220828174000895](C:\Users\lirui\AppData\Roaming\Typora\typora-user-images\image-20220828174000895.png)
